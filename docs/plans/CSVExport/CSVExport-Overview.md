# CSV Export Feature - Overview

## Feature Summary

Add CSV download functionality across the app dashboard to export race results, qualifying results, round standings, and season standings. This feature enables users to download data for offline analysis, record keeping, or sharing.

## Architecture Decision

**Approach: Backend API**
- CSV files will be generated by dedicated backend API endpoints
- Frontend will trigger downloads by calling these endpoints
- Provides better control over data formatting and consistency
- Supports proper filename generation and content-type headers

## Export Locations

| Location | Component | Export Type | Filename Pattern |
|----------|-----------|-------------|------------------|
| Race Results Modal | `RaceResultModal.vue` | Race Results | `{competition}-{season}-{round}-{race}-results.csv` |
| Race Results Modal | `RaceResultModal.vue` | Qualifying Results | `{competition}-{season}-{round}-{qualifier}-results.csv` |
| Round Results Modal | `RoundResultsModal.vue` | Round Standings | `{competition}-{season}-{round}-standings.csv` |
| Round Results Modal | `RoundResultsModal.vue` | Fastest Laps | `{competition}-{season}-{round}-fastest-laps.csv` |
| Round Results Modal | `RoundResultsModal.vue` | Race Times | `{competition}-{season}-{round}-race-times.csv` |
| Round Results Modal | `RoundResultsModal.vue` | Qualifying Times | `{competition}-{season}-{round}-qualifying-times.csv` |
| Season Standings | `StandingsView.vue` | Season Standings | `{competition}-{season}-standings.csv` |

## Data Rules

### Division Handling
- When divisions are enabled, drivers are grouped by division (in division order)
- Within each division, drivers are sorted by their position
- Division column shows division name; empty when divisions are disabled

### Team Handling
- Team column shows team name when driver belongs to a team
- Empty/blank when teams are disabled or driver has no team

### Points Column
- Shows points when race/qualifying has points enabled
- Empty when points are not enabled for the event

### Button Visibility
- Download buttons only appear when results are in read-only mode (round/race completed)

## CSV Headers by Export Type

### Race Results
```
Position, Division, Driver Name, Team, Race Time, Time Difference, Penalties, Fastest Lap, Points
```

### Qualifying Results
```
Position, Division, Driver Name, Team, Qualifying Lap, Time Difference
```

### Round Standings
```
Position, Division, Driver Name, Team, Round Points
```

### Cross-Division Results (Fastest Laps, Race Times, Qualifying Times)
```
Position, Division, Driver Name, Team, Time, Time Difference
```

### Season Standings
```
Position, Division, Driver Name, Team, R1 Points, R1 FL, R1 Pole, R2 Points, R2 FL, R2 Pole, ..., Total Points, Drop Round Total
```
- Each completed round has 3 columns: Points, FL (1 or blank), Pole (1 or blank)
- Drop Round Total column only appears when drop round feature is enabled

## Related Documentation

- **[Backend Plan](./CSVExport-Backend-Plan.md)** - API endpoints, services, and DTOs
- **[Frontend Plan](./CSVExport-Frontend-Plan.md)** - Vue components and download integration

## Implementation Agents

| Agent | Responsibility |
|-------|---------------|
| `dev-be` | Backend API endpoints, services, DTOs |
| `dev-fe-app` | Frontend components for app dashboard |

## Implementation Order

1. **Phase 1: Backend** - Create export service and API endpoints
2. **Phase 2: Frontend** - Add download buttons and integrate with API
3. **Phase 3: Testing** - Unit tests for backend, E2E tests for download flows
