includes:
    - vendor/larastan/larastan/extension.neon
    - phpstan-baseline.neon

parameters:
    level: 8
    paths:
        - app
        - config
        - database
        - routes
    scanFiles:
        - _ide_helper.php
        - .phpstorm.meta.php
    excludePaths:
        - bootstrap/cache
        - storage
        - vendor
        - database/migrations.backup
    ignoreErrors:
        # Laravel Eloquent relationship covariance issues - known false positives
        -
            message: '#should return .+ but returns .+\$this\(.+\)>#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # Laravel Model fillable property type covariance
        -
            message: '#PHPDoc type array<string> of property .+::\$fillable is not covariant#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # Undefined $this in console routes (Laravel closure context)
        -
            message: '#Undefined variable: \$this#'
            path: routes/console.php
        # Object property access in seeders (Laravel factory returns)
        -
            message: '#Access to an undefined property object::\$id#'
            path: database/seeders/*
        # Unused methods in domain entities (used via events/reflection)
        -
            message: '#Method .+::recordEvent\(\) is unused#'
        # Always false negation checks (from PHPDoc types)
        -
            message: '#Negated boolean expression is always false#'
        # Missing type hints for array parameters (will fix gradually)
        -
            message: '#has parameter \$.+ with no (value type specified in iterable type array|type specified)#'
        # If condition always false (from strict type checking)
        -
            message: '#If condition is always false#'
        # Return type issues in value objects (nullable intermediate values)
        -
            message: '#should return string but returns string\|null#'
            path: app/Domain/*/ValueObjects/*
        # Argument type issues with preg_replace and nullable strings
        -
            message: '#of function (preg_replace|trim) expects .+, string\|null given#'
            path: app/Domain/*/ValueObjects/*
        # Hash::make with nullable password
        -
            message: '#of static method .+Hash::make\(\) expects string, string\|null given#'
        # Offset access in pagination metadata
        -
            message: '#Offset ''last_page'' does not exist on array#'
            path: app/Application/*/Services/*
        # Static method calls on exception classes
        -
            message: '#Call to an undefined static method .+Exception::(notFound|withId|withEmail|withName)\(\)#'
        # Migration missing return types
        -
            message: '#Method .+(up|down)\(\) has no return type specified#'
            path: database/migrations/*
        # ForeignKeyDefinition comment method (Laravel magic)
        -
            message: '#Call to an undefined method .+ForeignKeyDefinition::comment\(\)#'
            path: database/migrations/*
        # HasFactory trait generic type usage
        -
            message: '#uses generic trait .+HasFactory but does not specify its types#'
        # Laravel Schema facade connection method
        -
            message: '#Call to an undefined static method Illuminate\\Support\\Facades\\Schema::connection\(\)#'
            path: database/migrations/*
        # Carbon/DateTime type conversion issues
        -
            message: '#Parameter \#1 \$object of static method DateTimeImmutable::createFromMutable\(\) expects DateTime, Illuminate\\Support\\Carbon\|null given#'
        -
            message: '#does not accept Carbon\\Carbon\|null#'
        # Object property access (stdClass from queries)
        -
            message: '#Access to an undefined property object::\$.+#'
        # Carbon null check issues
        -
            message: '#Cannot call method toDateTimeString\(\) on Illuminate\\Support\\Carbon\|null#'
        # Instanceof always true (domain events)
        -
            message: '#Instanceof between .+ and .+ will always evaluate to true#'
        # Assert with true
        -
            message: '#Call to function assert\(\) with true will always evaluate to true#'
        # Missing iterable value type in property PHPDoc
        -
            message: '#has PHPDoc tag @property for property .+ with no value type specified in iterable type array#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # Eloquent Factory missing generic types
        -
            message: '#Method .+::newFactory\(\) .+ type .+Factory#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # Eloquent Relation missing generic types
        -
            message: '#(Method|PHPDoc tag @return with type) .+(BelongsTo|HasMany|BelongsToMany|MorphMany|HasOne|MorphOne).+ does not specify its types#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        -
            message: '#Unable to resolve the template type .+ in call to method .+(belongsTo|hasMany|belongsToMany|morphMany|hasOne|morphOne)#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # Class not found (wrong model name)
        -
            message: '#Class App\\Infrastructure\\Persistence\\Eloquent\\Models\\(User|CompetitionEloquent) not found#'
        -
            message: '#Anonymous function should return .+ but returns .+#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # belongsTo/belongsToMany argument type
        -
            message: '#Parameter \#1 .+ of method .+::(belongsTo|belongsToMany)\(\) expects class-string.+, string given#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # Property type mismatches in repositories
        -
            message: '#Property .+ does not accept .+#'
            path: app/Infrastructure/Persistence/Eloquent/Repositories/*
        # Model method return types with relations
        -
            message: '#Method .+::(league|platform|createdBy|leagues|drivers|owner|competition)\(\)#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # newFactory return type
        -
            message: '#Method .+::newFactory\(\) should return .+Factory.+ but returns .+Factory#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # Type in generic type issues
        -
            message: '#Type .+ in generic type#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # Generic type does not specify all template types
        -
            message: '#Generic type .+ in PHPDoc tag @return does not specify all template types of class#'
            path: app/Infrastructure/Persistence/Eloquent/Models/*
        # Spatie Media Library trait methods
        -
            message: '#Call to an undefined method Spatie\\MediaLibrary\\HasMedia::(getFirstMedia|addMedia|clearMediaCollection)\(\)#'
            path: app/Infrastructure/Media/*
