# Plan: All Times Tab - Show Actual Time with Gap Beneath

## Overview

Update the "All Times" tab in `SeasonDetailWhiteLabelView.vue` so that the Qualifying, Race Time, and Fastest Lap columns always show the **actual time** for every driver, with the **gap to the leader shown in brackets beneath** for non-leader drivers.

## Current Behavior

- Leader: shows absolute time (e.g., `01:32.456`)
- Other drivers: shows only the gap (e.g., `+01.234`) - the actual time is lost

## Desired Behavior

- Leader: shows absolute time (e.g., `01:32.456`)
- Other drivers: shows absolute time on top (e.g., `01:33.690`), with gap in brackets beneath (e.g., `(+01.234)`)

## Agent

- `dev-fe-public` (Public Dashboard frontend work in `resources/public`)

## File

- `resources/public/js/views/leagues/SeasonDetailWhiteLabelView.vue`

---

## Phase 1: Update Data Model

**File:** `resources/public/js/views/leagues/SeasonDetailWhiteLabelView.vue`

### Step 1.1: Expand `CombinedTimeEntry` interface (line ~1446)

Add three new gap fields to the interface:

```typescript
interface CombinedTimeEntry {
  driverName: string;
  divisionId: number | null;
  divisionName: string | null;
  qualifyingTimeMs: number | null;
  raceTimeMs: number | null;
  fastestLapMs: number | null;
  qualifyingFormatted: string;
  qualifyingGap: string | null;       // NEW
  raceFormatted: string;
  raceGap: string | null;             // NEW
  fastestLapFormatted: string;
  fastestLapGap: string | null;       // NEW
}
```

### Step 1.2: Initialize new fields in `getCombinedTimesData()` (lines ~1492, ~1520, ~1549)

When creating new `CombinedTimeEntry` objects in `driverMap.set(...)`, add:
- `qualifyingGap: null`
- `raceGap: null`
- `fastestLapGap: null`

There are three places where `driverMap.set(...)` is called (qualifying, race time, fastest lap processing). All three need the new fields.

### Step 1.3: Update formatting logic (lines ~1588-1631)

Change the formatting loop so that:
- `qualifyingFormatted` / `raceFormatted` / `fastestLapFormatted` **always** show the absolute time via `formatTime()`
- The new gap fields (`qualifyingGap` / `raceGap` / `fastestLapGap`) are populated with `formatTimeDifference()` for non-leaders, and left `null` for the leader

**Before (qualifying example):**
```typescript
if (entry.qualifyingTimeMs === fastestQualifyingMs) {
  entry.qualifyingFormatted = formatTime(entry.qualifyingTimeMs);
} else if (fastestQualifyingMs !== null) {
  const diff = entry.qualifyingTimeMs - fastestQualifyingMs;
  entry.qualifyingFormatted = formatTimeDifference(diff);
}
```

**After:**
```typescript
if (entry.qualifyingTimeMs !== null) {
  entry.qualifyingFormatted = formatTime(entry.qualifyingTimeMs);
  if (entry.qualifyingTimeMs !== fastestQualifyingMs && fastestQualifyingMs !== null) {
    const diff = entry.qualifyingTimeMs - fastestQualifyingMs;
    entry.qualifyingGap = formatTimeDifference(diff);
  }
} else {
  entry.qualifyingFormatted = '-';
}
```

Apply the same pattern for race time and fastest lap.

---

## Phase 2: Update Template

**File:** `resources/public/js/views/leagues/SeasonDetailWhiteLabelView.vue`

### Step 2.1: Update the three `<td>` cells (lines ~745-747)

**Before:**
```html
<td class="td-time">{{ entry.qualifyingFormatted }}</td>
<td class="td-time">{{ entry.raceFormatted }}</td>
<td class="td-time">{{ entry.fastestLapFormatted }}</td>
```

**After:**
```html
<td class="td-time">
  <div>{{ entry.qualifyingFormatted }}</div>
  <div v-if="entry.qualifyingGap" class="time-gap">({{ entry.qualifyingGap }})</div>
</td>
<td class="td-time">
  <div>{{ entry.raceFormatted }}</div>
  <div v-if="entry.raceGap" class="time-gap">({{ entry.raceGap }})</div>
</td>
<td class="td-time">
  <div>{{ entry.fastestLapFormatted }}</div>
  <div v-if="entry.fastestLapGap" class="time-gap">({{ entry.fastestLapGap }})</div>
</td>
```

### Step 2.2: Add `.time-gap` CSS class

Add to the existing `<style>` block:

```css
.time-gap {
  font-size: 0.75rem;
  opacity: 0.6;
  margin-top: 0.125rem;
}
```

---

## Out of Scope

- No backend changes required (data already includes `time_ms` values)
- No changes to the "Round Results" tab race/qualifying tables (those already show actual times)
- No changes to types/interfaces outside this file
- No new tests (this is a display-only change in a whitelabel view)

## Success Criteria

### Automated Verification
- [x] TypeScript type checking passes: `npm run type-check` (pre-existing vite.config.ts errors only)
- [x] JavaScript/TypeScript ESLint passes: `npm run lint` and `npm run lint:fix`
- [x] Formatting passes: `npm run format`
- [x] Vite build succeeds: `npm run build` (vite build passes; vue-tsc has pre-existing vite.config.ts errors)

### Manual Verification
- [ ] Navigate to a season with `race_times_required = true`
- [ ] Open a round accordion, click "All Times" tab
- [ ] Leader row shows absolute time only (no gap)
- [ ] Non-leader rows show absolute time on top, gap in brackets (`(+XX.XXX)`) beneath
- [ ] All three columns (Qualifying, Race Time, Fastest Lap) display correctly
- [ ] Gap text is smaller and slightly faded compared to the main time
- [ ] Sorting by column still works correctly
