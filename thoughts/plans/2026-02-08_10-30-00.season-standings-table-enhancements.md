# Implementation Plan: Season Standings Table Enhancements

## Overview

Update the Division Tables and non-division driver standings tables in `SeasonDetailWhiteLabelView.vue` to add new columns:
1. **Team column** (before Driver) - 48px wide, shows team image, only visible when teams are enabled
2. **Podiums column** - Tally of 1st, 2nd, or 3rd finishing positions across all rounds
3. **Round sub-columns** - Split each round column into 3 sub-columns: FL (fastest lap), P (pole), Pts (round points)

## Agent

- `dev-fe-public` - Public site Vue.js frontend development

## Current State

The file `resources/public/js/views/leagues/SeasonDetailWhiteLabelView.vue` contains:
- Division Tables (lines 82-168) - When `has_divisions` is true
- Flat Drivers Table (lines 170-249) - When `has_divisions` is false and no teams championship
- Drivers Tab Table (lines 251-330) - When teams championship exists but viewing drivers tab

The `SeasonStandingDriver` type already has:
- `podiums: number` - already calculated on backend
- `poles: number` - already available
- `team_id`, `team_name`, `team_logo` - team data available
- `rounds[].has_pole`, `rounds[].has_fastest_lap`, `rounds[].points`, `rounds[].position` - round-level data

The `team_championship_enabled` boolean on the response indicates if teams are enabled.

## Implementation Phases

### Phase 1: Add Teams Column

**Files to modify:**
- `resources/public/js/views/leagues/SeasonDetailWhiteLabelView.vue`

**Changes:**

1. Add computed property to check if teams should be shown:
```typescript
const showTeamsColumn = computed<boolean>(() => {
  return seasonData.value?.team_championship_enabled === true;
});
```

2. Update Division Tables header (around line 93):
```html
<th class="th-position">#</th>
<th v-if="showTeamsColumn" class="th-team">Team</th>
<th class="th-driver">Driver</th>
```

3. Add team cell in Division Tables body (after position, before driver name around line 113):
```html
<td v-if="showTeamsColumn" class="td-team">
  <img
    v-if="driver.team_logo"
    :src="driver.team_logo"
    :alt="driver.team_name || 'Team'"
    class="team-logo-standalone"
  />
</td>
```

4. Apply same changes to:
   - Flat Drivers Table (lines 176-209)
   - Drivers Tab Table (lines 259-291)

5. Add CSS for team column:
```css
.th-team,
.td-team {
  width: 48px;
  min-width: 48px;
  max-width: 48px;
  text-align: center;
  padding: 0.25rem;
}

.team-logo-standalone {
  width: 32px;
  height: 32px;
  object-fit: contain;
}
```

6. Remove the team logo from inside the Driver column since it's now in its own column

### Phase 2: Add Podiums Column

**Files to modify:**
- `resources/public/js/views/leagues/SeasonDetailWhiteLabelView.vue`

**Changes:**

1. Add Podiums column header after Driver column:
```html
<th class="th-podiums">Podiums</th>
```

2. Add Podiums cell in body:
```html
<td class="td-podiums">{{ driver.podiums }}</td>
```

3. Apply to all three tables:
   - Division Tables
   - Flat Drivers Table
   - Drivers Tab Table

4. Add CSS:
```css
.th-podiums,
.td-podiums {
  text-align: center;
  min-width: 60px;
}
```

### Phase 3: Split Round Columns into Sub-Columns

**Files to modify:**
- `resources/public/js/views/leagues/SeasonDetailWhiteLabelView.vue`

**Changes:**

1. Update round header to span 3 columns with sub-headers:
```html
<template v-for="roundNum in getRoundNumbers(division.drivers)" :key="`header-${roundNum}`">
  <th :colspan="3" class="th-round-group">R{{ roundNum }}</th>
</template>
```

Add a second header row for sub-columns:
```html
<tr class="sub-header-row">
  <th></th> <!-- Position -->
  <th v-if="showTeamsColumn"></th> <!-- Team -->
  <th></th> <!-- Driver -->
  <th></th> <!-- Podiums -->
  <template v-for="roundNum in getRoundNumbers(division.drivers)" :key="`subheader-${roundNum}`">
    <th class="th-fl">FL</th>
    <th class="th-pole">P</th>
    <th class="th-pts">Pts</th>
  </template>
  <th></th> <!-- Total -->
  <th v-if="seasonData.drop_round_enabled"></th> <!-- Drop -->
</tr>
```

2. Update round cells to be 3 separate cells:
```html
<template v-for="roundNum in getRoundNumbers(division.drivers)" :key="`round-${driver.driver_id}-${roundNum}`">
  <td class="td-fl">
    <span v-if="getRoundData(driver, roundNum)?.has_fastest_lap" class="badge badge-fl" title="Fastest Lap">✓</span>
    <span v-else>-</span>
  </td>
  <td class="td-pole">
    <span v-if="getRoundData(driver, roundNum)?.has_pole" class="badge badge-pole" title="Pole Position">✓</span>
    <span v-else>-</span>
  </td>
  <td class="td-pts">
    {{ getRoundData(driver, roundNum)?.points ?? '-' }}
  </td>
</template>
```

3. Apply same changes to all three tables

4. Add CSS for sub-columns:
```css
.th-round-group {
  text-align: center;
  border-bottom: 1px solid var(--wl-border);
}

.sub-header-row th {
  font-size: 0.7rem;
  font-weight: 500;
  color: var(--wl-text-secondary);
  padding: 0.25rem;
}

.th-fl,
.th-pole,
.th-pts,
.td-fl,
.td-pole,
.td-pts {
  text-align: center;
  min-width: 30px;
  padding: 0.25rem;
}

.td-fl .badge-fl,
.td-pole .badge-pole {
  font-size: 0.65rem;
}
```

### Phase 4: Update CSV Export

**Files to modify:**
- `resources/public/js/views/leagues/SeasonDetailWhiteLabelView.vue`

The CSV export function `generateDriverStandingsCSV` already handles the sub-columns correctly (see lines 2036-2041):
```typescript
for (const roundNum of roundNumbers) {
  headers.push(`r${roundNum}_pole`, `r${roundNum}_fl`, `r${roundNum}_pts`);
}
```

The CSV export is already correct. No changes needed.

## Implementation Order

1. Phase 1: Add Teams Column
2. Phase 2: Add Podiums Column
3. Phase 3: Split Round Columns into Sub-Columns
4. Phase 4: Verify CSV Export (no changes needed)

## Files to Modify

| File | Changes |
|------|---------|
| `resources/public/js/views/leagues/SeasonDetailWhiteLabelView.vue` | Add Team/Podiums columns, split round columns, add CSS |

## Out of Scope

- Backend API changes (all data is already available)
- Type definitions (already complete)
- Teams Championship Table (only driver standings tables)

## Success Criteria

### Automated Verification:
- [x] All Vitest tests pass: `.claude/support/scripts/vitests_run_tests.sh`
- [x] No linting errors: `npm run lint && npm run lint:fix`
- [x] TypeScript type checking passes: `npm run type-check`
- [x] Formatting passes: `npm run format`

### Manual Verification:
- [ ] Team column appears only when `team_championship_enabled` is true
- [ ] Team column shows team logo (32x32px) in 48px wide column
- [ ] Team column appears before Driver column
- [ ] Podiums column shows correct count after Driver column
- [ ] Each round column is split into FL, P, Pts sub-columns
- [ ] Sub-column headers (FL, P, Pts) are visible
- [ ] FL shows checkmark when `has_fastest_lap` is true, dash otherwise
- [ ] P shows checkmark when `has_pole` is true, dash otherwise
- [ ] Pts shows round points
- [ ] All three driver tables updated: Division, Flat, Drivers Tab
- [ ] CSV export still works correctly
- [ ] Table is responsive on mobile (may need horizontal scroll)

## Technical Notes

1. The `showTeamsColumn` computed checks `team_championship_enabled` to determine if teams should be shown
2. The `podiums` property is already calculated by the backend - no frontend calculation needed
3. Using `<template>` fragments for the grouped headers allows proper colspan handling
4. A second header row is needed for the sub-column labels (FL, P, Pts)
5. The CSS uses fixed widths for the team column (48px) and sub-columns (30px min) to ensure consistent layout
