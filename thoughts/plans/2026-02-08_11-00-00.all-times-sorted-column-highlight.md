# Implementation Plan: Split Time/Gap Into Separate Columns in CrossDivisionAllTimesTable

## Overview

Replace the VrlDataTable (PrimeVue DataTable wrapper) in `CrossDivisionAllTimesTable.vue` with a native HTML `<table>` to support multi-row headers with `colspan="2"` for grouped Time/Gap sub-columns. Each of the three time categories (Qualifying, Race Time, Fastest Lap) will be split from a single stacked column into two side-by-side columns: one for the absolute time and one for the gap.

## Agent

- `dev-fe-public` — Public site Vue component work in `resources/public/`

## Current State

**File**: `resources/public/js/components/leagues/rounds/CrossDivisionAllTimesTable.vue`

Currently uses `VrlDataTable` with PrimeVue `<Column>` components. Each time category (Qualifying, Race, Fastest Lap) renders both the absolute time and the gap stacked vertically within a single `<td>`:

```
| # | Driver | Division | Qualifying  | Race Time   | Fastest Lap |
|   |        |          | 01:23.456   | 01:45.789   | 01:20.123   |
|   |        |          | (+00.234)   | (+01.567)   | (+00.089)   |
```

## Target State

Switch to native HTML `<table>` with two-row headers and separate Time/Gap columns:

```
| # | Driver | Division | Qualifying Time  | Race Time        | Fastest Lap      |
|   |        |          | Time    | Gap    | Time    | Gap    | Time    | Gap    |
|---|--------|----------|---------|--------|---------|--------|---------|--------|
| 1 | Name   | Div1     | 01:23   | -      | 01:45   | -      | 01:20   | -      |
| 2 | Name2  | Div1     | 01:23   | +00.23 | 01:46   | +01.56 | 01:20   | +00.08 |
```

## Reference Implementation

`SeasonDetailWhiteLabelView.vue` (lines 744-871) already implements this exact pattern with native HTML tables using `colspan="2"` headers and `rowspan="2"` for Position/Driver/Division columns.

## Implementation Steps

### Phase 1: Replace VrlDataTable with Native HTML Table

**File**: `resources/public/js/components/leagues/rounds/CrossDivisionAllTimesTable.vue`

#### 1.1 Update imports

- Remove: `Column` from `primevue/column`, `VrlDataTable`, `VrlPositionCell`
- Keep: `ref`, `computed`, `VrlButton`, `useGtm`, `PhDownloadSimple`, types

#### 1.2 Replace template

Replace the `<VrlDataTable>` block (lines 20-161) with a native HTML table structure:

**Header Row 1** (using `rowspan="2"` and `colspan="2"`):
- `#` column — `rowspan="2"`, width ~60px
- `Driver` column — `rowspan="2"`, min-width 200px
- `Division` column (conditional on `hasDivisions`) — `rowspan="2"`, width 180px
- `Qualifying Time` — `colspan="2"`, sortable, click handler `setSortColumn('qualifying')`
- `Race Time` — `colspan="2"`, sortable, click handler `setSortColumn('race')`
- `Fastest Lap` — `colspan="2"`, sortable, click handler `setSortColumn('fastest')`

**Header Row 2** (sub-headers):
- 3× pairs of `Time` | `Gap` sub-header cells

**Body rows** (iterate `sortedData`):
- Position cell with podium highlighting (index + 1)
- Driver name cell
- Division badge cell (conditional)
- 3× pairs of:
  - Time cell: `entry.qualifyingTimeAbsolute` / `entry.raceTimeAbsolute` / `entry.fastestLapAbsolute`
  - Gap cell: `entry.qualifyingGap || '-'` / `entry.raceGap || '-'` / `entry.fastestLapGap || '-'`
- Add `column-sorted` class to Time/Gap cells when their parent column is the active sort column

**Empty state**: When `sortedData` is empty, show a single row with colspan spanning all columns: "No times available"

#### 1.3 Add podium highlighting

Add a helper function for podium row classes:
- Position 1: gold background tint
- Position 2: silver background tint
- Position 3: bronze background tint

```typescript
function getPodiumClass(position: number): string {
  if (position === 1) return 'podium-1';
  if (position === 2) return 'podium-2';
  if (position === 3) return 'podium-3';
  return '';
}
```

#### 1.4 Responsive text

Keep the existing responsive pattern:
- Desktop: "Qualifying Time", "Race Time", "Fastest Lap"
- Mobile: "Quali", "Race", "FL"

### Phase 2: Scoped Styles

#### 2.1 Add scoped CSS styles

Use the existing CSS variables from the component's context (`--text-primary`, `--text-secondary`, `--bg-elevated`, `--border`, `--cyan`, `--font-mono`, `--font-display`, `--radius-sm`, etc.).

Key style classes to add:

```css
/* Table wrapper for horizontal scroll */
.all-times-table-wrapper {
  overflow-x: auto;
  border: 1px solid var(--border);
  border-radius: var(--radius);
}

/* Table base */
.all-times-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
}

/* Header styling */
.all-times-table thead {
  background: var(--bg-elevated);
}

.all-times-table th {
  padding: 0.5rem;
  text-align: center;
  font-weight: 700;
  font-family: var(--font-display);
  color: var(--text-primary);
  font-size: 0.75rem;
  text-transform: uppercase;
  border-bottom: 1px solid var(--border);
}

/* Group headers with colspan */
.all-times-table .th-time-group {
  text-align: center;
  border-bottom: 1px solid var(--border);
}

.all-times-table .th-time-group.sortable {
  cursor: pointer;
  user-select: none;
  transition: color 0.15s ease;
  position: relative;
}

.all-times-table .th-time-group.sortable:hover {
  color: var(--text-primary);
}

.all-times-table .th-time-group.sortable.is-sorted {
  color: var(--cyan);
}

/* Sort arrow */
.all-times-table .sort-arrow {
  font-size: 0.6rem;
  margin-left: 0.25rem;
}

/* Sub-header row */
.all-times-table .sub-header-row .th-sub {
  font-size: 0.65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 0.25rem 0.5rem;
  color: var(--text-secondary);
}

.all-times-table .th-sub.th-time {
  border-right: 1px solid var(--border);
}

/* Body cells */
.all-times-table td {
  padding: 0.5rem 0.75rem;
  text-align: center;
  color: var(--text-primary);
  border-bottom: 1px solid var(--border);
}

.all-times-table .td-driver {
  text-align: left;
  font-weight: 600;
  font-size: 1.05rem;
}

.all-times-table .td-time {
  font-family: var(--font-mono);
  font-weight: 700;
  font-size: 1rem;
  text-align: right;
  border-right: 1px solid var(--border);
}

.all-times-table .td-gap {
  font-family: var(--font-mono);
  font-size: 0.8rem;
  color: var(--text-secondary);
  text-align: left;
  padding-left: 0.5rem;
}

/* Sorted column highlight */
.all-times-table .td-time.column-sorted,
.all-times-table .td-gap.column-sorted {
  background: rgba(6, 182, 212, 0.06);
}

/* Podium row highlights */
.all-times-table .podium-1 {
  background: rgba(212, 175, 55, 0.08);
}

.all-times-table .podium-2 {
  background: rgba(148, 163, 184, 0.08);
}

.all-times-table .podium-3 {
  background: rgba(205, 127, 50, 0.08);
}

/* Hover */
.all-times-table tbody tr:hover {
  background: var(--bg-elevated);
}

/* Last row no bottom border */
.all-times-table tbody tr:last-child td {
  border-bottom: none;
}
```

#### 2.2 Remove old styles

Remove the existing `.sortable-header`, `.is-sorted`, and `.sort-arrow` styles that were tied to the VrlDataTable column headers.

### Phase 3: Preserve Existing Functionality

#### 3.1 Sort behavior — No changes needed

- `sortColumn` ref and `setSortColumn()` function remain unchanged
- `sortedData` computed remains unchanged
- Sort arrow indicator moves to the grouped header cell

#### 3.2 CSV export — No changes needed

- `exportToCSV()` function remains unchanged — it already exports separate Time and Gap columns

#### 3.3 Division badges — No changes needed

- `getDivisionBadgeClass()` function remains unchanged
- Badge rendering moves from PrimeVue Column body slot to a native `<td>`

## Files Modified

| File | Action |
|------|--------|
| `resources/public/js/components/leagues/rounds/CrossDivisionAllTimesTable.vue` | Template rewrite (VrlDataTable → native HTML table) + style updates |

## Out of Scope

- Changes to data computation logic (`combinedData`, `sortedData` computeds)
- Changes to the CSV export function
- Changes to the parent component or props interface
- Changes to VrlDataTable component
- Changes to SeasonDetailWhiteLabelView.vue
- Changes to any other components

## Success Criteria

### Automated Verification
- [ ] All Vitest tests pass: `.claude/support/scripts/vitests_run_tests.sh`
- [ ] TypeScript type checking passes: `npm run type-check`
- [ ] ESLint passes: `npm run lint`
- [ ] Formatting passes: `npm run format`

### Manual Verification
- [ ] All Times table displays with two-row headers: grouped "Qualifying Time", "Race Time", "Fastest Lap" on row 1, "Time" / "Gap" sub-headers on row 2
- [ ] Time column shows absolute time (e.g., `01:23.456`), Gap column shows difference (e.g., `+00.234`) or `-` for the leader
- [ ] Clicking column group header sorts by that time category
- [ ] Active sort column header is visually highlighted (cyan color)
- [ ] Sorted column's Time and Gap cells have a subtle background highlight
- [ ] Podium rows (positions 1-3) have gold/silver/bronze background tints
- [ ] Division badges display correctly when divisions exist
- [ ] Responsive: headers show abbreviated text on mobile ("Quali", "Race", "FL")
- [ ] "Export Data" CSV button still works correctly
- [ ] Empty state shows "No times available" when no data
- [ ] Table scrolls horizontally on narrow screens
