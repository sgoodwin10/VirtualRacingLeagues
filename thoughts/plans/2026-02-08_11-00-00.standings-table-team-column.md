# Implementation Plan: Add Team Column to StandingsTable

## Overview

Add a new **Team** column (60px wide) before the **Driver** column in `StandingsTable.vue`. The column displays the team logo image and is only visible when `team_championship_enabled` is true. When the Team column is shown, remove the team logo/name from inside the Driver column to avoid duplication.

## Agent

- `dev-fe-public` - Public site Vue.js frontend development

## Current State

File: `resources/public/js/components/leagues/StandingsTable.vue`

The component has **3 driver standings tables** that all need updating:

1. **Division Tables** (lines 90-179) - When `has_divisions` is true, one table per division
2. **Drivers Tab Table** (lines 188-277) - When no divisions but teams championship exists
3. **Single Table** (lines 354-440) - No divisions and no teams championship (simple view)

Each table currently has these columns: `#` | `Driver` (with team logo/name inline) | `Podiums` | Round columns (P, FL, Pts) | `Total` | `Drop`

The `showTeamsChampionship` computed (line 500) already checks `team_championship_enabled`.

Driver data includes: `team_id`, `team_name`, `team_logo` (all nullable).

## Implementation

### Phase 1: Add Team Column to All Three Tables

**File to modify:** `resources/public/js/components/leagues/StandingsTable.vue`

#### 1.1 - Division Tables (lines 90-179)

**Header** - Add after `th.th-position` (line 93), before `th.th-driver` (line 94):
```html
<th v-if="showTeamsChampionship" class="th-team" rowspan="2">Team</th>
```

**Body** - Add after `td.td-position` (line 126-128), before `td.td-driver` (line 129):
```html
<td v-if="showTeamsChampionship" class="td-team">
  <img
    v-if="driver.team_logo"
    :src="driver.team_logo"
    :alt="driver.team_name || 'Team'"
    class="team-column-logo"
  />
</td>
```

**Remove team info from Driver cell** - When `showTeamsChampionship` is true, the driver cell (lines 130-138) currently shows team logo/name. We'll conditionally hide the team logo/name span elements when the Team column is visible:
```html
<td class="td-driver">
  <div class="driver-info">
    <span class="driver-name">{{ driver.driver_name }}</span>
    <template v-if="!showTeamsChampionship">
      <span v-if="driver.team_logo" class="team-logo">
        <img :src="driver.team_logo" :alt="driver.team_name || 'Team'" />
      </span>
      <span v-else-if="driver.team_name" class="team-name">{{ driver.team_name }}</span>
    </template>
  </div>
</td>
```

#### 1.2 - Drivers Tab Table (lines 188-277)

Same pattern as Division Tables - add `th` after position header, add `td` after position cell, conditionally hide team info from driver cell.

#### 1.3 - Single Table (lines 354-440)

Same pattern. Note: `showTeamsChampionship` will be false for the single table scenario (since the single table is only rendered via `v-else` when there are no divisions and no team championship), so the Team column won't appear here. But for consistency and future-proofing, add the `v-if="showTeamsChampionship"` header/cell here too (they'll never render).

### Phase 2: Add CSS Styles

Add these styles in the `<style scoped>` section:

```css
/* Team Column Header */
.standings-table th.th-team {
  width: 60px;
  min-width: 60px;
  max-width: 60px;
  text-align: center;
}

/* Team Column Cell */
.td-team {
  width: 60px;
  min-width: 60px;
  max-width: 60px;
  text-align: center;
  padding: 4px;
}

/* Team Logo in dedicated column */
.team-column-logo {
  height: 24px;
  width: auto;
  max-width: 48px;
  object-fit: contain;
  display: block;
  margin: 0 auto;
}
```

### Phase 3: Fix Round Cell Border Selector

The current CSS uses `nth-child` selectors to add borders between round groups:
```css
.td-round:nth-child(3n + 6) {
  border-right: 1px solid var(--border);
}
```

This selector assumes a fixed number of columns before the rounds start. Adding the Team column shifts the column indices. Since the Team column is conditional, we need to adjust this.

**Approach:** The `nth-child` border rule at line 1133 needs to account for the optional Team column. The safest approach is to not touch this — the existing rule already works imperfectly for the conditional podiums column. Instead, add a class-based approach by adding a `round-group-end` class to the last `td` in each round group (the Pts cell) and style it with a right border. However, this might be overly complex.

**Simpler approach:** Since the `sub-header th.th-sub:nth-child(3n)` rule at line 985 also has this issue, and the table already works with the podiums column present, the existing nth-child rules are likely already broken/imprecise. Leave them as-is for now — they don't cause visible issues since the round groups already have visual separation via the header colspan.

## Files to Modify

| File | Changes |
|------|---------|
| `resources/public/js/components/leagues/StandingsTable.vue` | Add Team column header/cells to 3 tables, add CSS, conditionally hide team info from driver cell |

## Out of Scope

- Backend API changes (all data already available)
- Type definition changes (types already have team fields)
- Teams Championship Table (already has its own team logo column)
- CSV export changes (already handles team data correctly)
- Single table scenario (Team column won't show since `showTeamsChampionship` is false)

## Success Criteria

### Automated Verification:
- [ ] All Vitest tests pass: `.claude/support/scripts/vitests_run_tests.sh`
- [ ] No linting errors: `npm run lint && npm run lint:fix`
- [ ] TypeScript type checking passes: `npm run type-check`
- [ ] Formatting passes: `npm run format`

### Manual Verification:
- [ ] Team column appears only when `team_championship_enabled` is true
- [ ] Team column is 60px wide and shows centered team logo
- [ ] Team column appears between `#` (position) and `Driver` columns
- [ ] Team logo/name is removed from the Driver cell when Team column is visible
- [ ] Team logo/name still shows inside Driver cell when Team column is NOT visible (single table mode)
- [ ] Division tables, Drivers tab table all show the Team column consistently
- [ ] Table is still horizontally scrollable on mobile
- [ ] CSV export still works correctly
